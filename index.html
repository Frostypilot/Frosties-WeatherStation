<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weather Logger</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #1e1e2f;
      color: #ffffff;
      margin: 0;
      padding: 0;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background-color: #2a2a3d;
      font-size: 18px;
    }
    .status {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .container {
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .card {
      background-color: #2a2a3d;
      border-radius: 10px;
      padding: 20px;
      width: 100%;
      max-width: 400px;
      margin-bottom: 20px;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.5);
    }
    .temperature-icon {
      font-size: 32px;
      margin-bottom: 10px;
    }
    .chart-container {
      width: 100%;
      max-width: 800px;
      margin: 20px auto;
      background-color: #2a2a3d;
      padding: 20px;
      border-radius: 10px;
    }
    canvas {
      background-color: #1e1e2f;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="status">
      <span><strong>Wi-Fi:</strong></span>
      <span id="wifiSignal">Fetching...</span>
    </div>
    <div class="status">
      <span><strong>Battery:</strong></span>
      <span id="batteryPercentage">Fetching...</span>%
    </div>
  </div>

  <div class="container">
    <div class="card">
      <h1>Weather Logger</h1>
      <div class="temperature-icon" id="temperatureIcon">
        <i class="fa-solid fa-spinner fa-spin"></i>
      </div>
      <p><strong>Temperature:</strong> <span id="temperature">Fetching...</span> &#8451;</p>
      <p><strong>Humidity:</strong> <span id="humidity">Fetching...</span> %</p>
      <p><strong>Battery Voltage:</strong> <span id="batteryVoltage">Fetching...</span> V</p>
    </div>
    <div class="chart-container">
      <canvas id="temperatureChart"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="humidityChart"></canvas>
    </div>
  </div>

  <script>
    const channelID = "2802750"; // Replace with your ThingSpeak Channel ID
    const readAPIKey = "3X1RW3MH5GLS1F9S"; // Replace with your ThingSpeak Read API Key

    // Fetch real-time data
    async function fetchRealTimeData() {
      try {
        const response = await fetch(`https://api.thingspeak.com/channels/${channelID}/feeds.json?api_key=${readAPIKey}&results=1`);
        const data = await response.json();
        const feed = data.feeds[0];

        updateRealTimeUI(feed);
      } catch (error) {
        console.error("Error fetching real-time data:", error);
      }
    }

    // Fetch historical data
    async function fetchHistoricalData() {
      try {
        const response = await fetch(`https://api.thingspeak.com/channels/${channelID}/feeds.json?api_key=${readAPIKey}&results=288`);
        const data = await response.json();
        const feeds = data.feeds;

        const timestamps = feeds.map(feed => new Date(feed.created_at).toLocaleTimeString());
        const temperatures = feeds.map(feed => parseFloat(feed.field1));
        const humidities = feeds.map(feed => parseFloat(feed.field2));

        const tempMin = Math.min(...temperatures);
        const tempMax = Math.max(...temperatures);
        const humidityMin = Math.min(...humidities);
        const humidityMax = Math.max(...humidities);

        createChart(
          'temperatureChart',
          `Temperature (Â°C) - Min: ${tempMin.toFixed(1)}, Max: ${tempMax.toFixed(1)}`,
          timestamps,
          temperatures,
          'rgba(255, 99, 132, 0.5)',
          'rgba(255, 99, 132, 1)'
        );

        createChart(
          'humidityChart',
          `Humidity (%) - Min: ${humidityMin.toFixed(1)}, Max: ${humidityMax.toFixed(1)}`,
          timestamps,
          humidities,
          'rgba(54, 162, 235, 0.5)',
          'rgba(54, 162, 235, 1)'
        );
      } catch (error) {
        console.error("Error fetching historical data:", error);
      }
    }

    // Update real-time UI
    function updateRealTimeUI(feed) {
      const temperature = parseFloat(feed.field1).toFixed(2);
      const humidity = parseFloat(feed.field2).toFixed(2);
      const batteryVoltage = parseFloat(feed.field3).toFixed(2);
      const batteryPercentage = parseFloat(feed.field4).toFixed(2);

      // Update UI elements
      document.getElementById("temperature").textContent = temperature;
      document.getElementById("humidity").textContent = humidity;
      document.getElementById("batteryVoltage").textContent = batteryVoltage;
      document.getElementById("batteryPercentage").textContent = batteryPercentage;

      // Update temperature icon based on temperature
      const temperatureIcon = document.getElementById("temperatureIcon");
      if (temperature <= 10) {
        temperatureIcon.innerHTML = "<i class='fa-solid fa-face-dizzy'></i>"; // Freezing face
      } else if (temperature > 10 && temperature <= 30) {
        temperatureIcon.innerHTML = "<i class='fa-solid fa-face-smile'></i>"; // Smiling face
      } else {
        temperatureIcon.innerHTML = "<i class='fa-solid fa-face-angry'></i>"; // Hot face
      }

      // Mock Wi-Fi signal for demonstration
      document.getElementById("wifiSignal").textContent = `${Math.floor(Math.random() * 100)}%`; // Replace with actual data if available
    }

    // Create a chart
    function createChart(canvasId, label, labels, data, bgColor, borderColor) {
      new Chart(document.getElementById(canvasId), {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: label,
            data: data,
            backgroundColor: bgColor,
            borderColor: borderColor,
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: label,
              font: {
                size: 18
              },
              color: '#ffffff'
            }
          },
          scales: {
            x: { beginAtZero: false },
            y: { beginAtZero: true }
          }
        }
      });
    }

    // Fetch data every 5 seconds
    setInterval(fetchRealTimeData, 5000);

    // Initial fetches
    fetchRealTimeData();
    fetchHistoricalData();
  </script>
</body>
</html>
